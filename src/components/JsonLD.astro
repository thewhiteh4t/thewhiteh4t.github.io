---
import logo from '../assets/logo_small.png'
const canonicalURL = new URL(Astro.url.pathname, Astro.site)
const blogURL = new URL('/blog', Astro.site)
const logoURL = new URL(logo.src, Astro.site)
let structuredData

if (Astro.url.pathname === '/') {
  structuredData = {
    '@context': 'https://schema.org',
    '@graph': [
      {
        '@type': 'Person',
        '@id': `${Astro.site}#person`,
        'name': 'Lohitya Pushkar',
        'alternateName': 'thewhiteh4t',
        'url': Astro.site,
        'image': logoURL,
        'jobTitle': 'Security Researcher & Penetration Tester',
        'description': 'Security researcher specializing in penetration testing, offensive security tooling, automated reconnaissance, and Agentic AI. Developer of Seeker, FinalRecon, and NExfil etc.',
        'knowsAbout': [
          'Offensive Security Tooling',
          'Automated Reconnaissance',
          'Vulnerability Research',
          'Memory Forensics',
          'Network Exploitation',
          'Agentic AI',
          'Security Automation'
        ],
        'sameAs': [
          'https://www.google.com/search?kgmid=/g/11yts41g9r',
          'https://orcid.org/0009-0000-5370-3402',
          'https://github.com/thewhiteh4t',
          'https://www.linkedin.com/in/lohityapushkar',
          'https://x.com/thewhiteh4t',
          'https://muckrack.com/lohitya-pushkar'
        ]
      },
      {
        '@type': 'ProfilePage',
        '@id': `${Astro.site}#profilepage`,
        'url': Astro.site,
        'name': 'Lohitya Pushkar (thewhiteh4t) - Security Researcher Profile',
        'mainEntity': { '@id': `${Astro.site}#person` }
      }
    ]
  }
} else if (Astro.url.pathname === '/blog/') {
  structuredData = {
    '@context': 'https://schema.org',
    '@type': 'Blog',
    name: 'thewhiteh4t Blog',
    url: blogURL,
    description:
      'The official blog for Lohitya Pushkar (thewhiteh4t), featuring articles on cybersecurity and security research.',
    publisher: {
      '@type': 'Person',
      name: 'Lohitya Pushkar',
      alternateName: 'thewhiteh4t',
      url: Astro.site,
    },
  }
} else if (
  Astro.url.pathname.startsWith('/blog/') &&
  Astro.locals.frontmatter
) {
  const img_src = new URL(Astro.locals.frontmatter.cardImage.src, Astro.site)
  structuredData = {
    '@context': 'https://schema.org',
    '@type': 'BlogPosting',
    mainEntityOfPage: canonicalURL,
    headline: Astro.locals.frontmatter.title,
    name: Astro.locals.frontmatter.title,
    description: Astro.locals.frontmatter.description,
    datePublished: Astro.locals.frontmatter.pubDate.toISOString(),
    dateModified:
      Astro.locals.frontmatter.updatedDate?.toISOString() ?? undefined,
    author: {
      '@type': 'Person',
      '@id': Astro.site,
      name: 'Lohitya Pushkar',
      alternateName: 'thewhiteh4t',
      url: Astro.site,
      image: {
        '@type': 'ImageObject',
        '@id': logoURL,
      },
    },
    publisher: {
      '@type': 'Person',
      '@id': Astro.site,
      name: 'Lohitya Pushkar',
      alternateName: 'thewhiteh4t',
      url: Astro.site,
      image: {
        '@type': 'ImageObject',
        '@id': logoURL,
      },
    },
    image: {
      '@type': 'ImageObject',
      '@id': img_src,
      url: img_src,
    },
    url: canonicalURL,
    isPartOf: {
      '@type': 'Blog',
      '@id': blogURL,
      name: 'thewhiteh4t blog',
      publisher: {
        '@type': 'Person',
        '@id': Astro.site,
        name: 'Lohitya Pushkar',
        alternateName: 'thewhiteh4t',
      },
    },
  }
}
---

{
  (Astro.url.pathname === '/' ||
    Astro.url.pathname === '/blog/' ||
    (Astro.url.pathname.startsWith('/blog/') && Astro.locals.frontmatter)) && (
    <script
      is:inline
      type="application/ld+json"
      set:html={JSON.stringify(structuredData)}
    />
  )
}
